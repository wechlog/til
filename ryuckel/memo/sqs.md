# SQS
アプリケーション間のメッセージのやりとり

## 特徴
- キューに格納できる1メッセージあたりのサイズは最大256KB。ただし、ExtendedClientLibraryを利用することで、2GBまでのメッセージが送受信可能になる。
- メッセージの送信または受信は、1APIリクエストあたり最大10件。
- キューには、デフォルトで4日間メッセージが保存される。設定により60秒から14日までの間で保存期間を変更可能。


## メッセージの識別子
- キューURL
キューが作成された時に生成されるURL
- メッセージID
SQSが受信したメッセージに対して割り当てられるID
- 受信バンドル
キューからメッセージを受信されるたびに発行される最大長1,024文字の文字列。  
これは、キューにあるメッセージの削除や可視性の変更を要求する際に指定します。メッセージが同じであっても、受信ハンドルの値はメッセージを受信するたびに変わります。

## スタンダードキューとFIFOキュー

- スタンダードキュー

受信側がキューに対してメッセージをリクエストした場合、少なくとも1回は確実に配信されますが、
リクエストのタイミングによっては、同じメッセージが複数回配信される場合があります。
メッセージの順序も送信された順序ではなくなる可能性がある

- FIFOキュー

スタンダードキューとは異なり、同じメッセージが複数回配信されることはありません。  
また、先入れ先出し（FirstInFirstOut）の配信が行われるため、キューに対してメッセージが送信された順序で配信されます。

## ショートポーリングとロングポーリング
デフォルトはショートポーリング
キューのメッセージの有無にかかわらずメッセージの取得要求を出す

空のレスポンスが多い場合はロングポーリングを利用して
メッセージ取得までの待ち時間を設定することで、避ける(コストも削減できる)

SQSのReceiveMessageのオプションのWaitTimeSecondsを0秒以上に設定するとロングポーリングになり、待ち時間を0秒から20秒までの間で設定できます。
メッセージが無い場合でも、最大ReceiveMessageのWaitTimeSecondsで指定した時間だけキューの取得処理を待たせることができる

## 遅延キュー
キューに新しいメッセージを送信した後、指定した時間が経過してから受信側にメッセージが表示されるようにしたい場合は、遅延キューを使用する

遅延キューでは、キューに送信したメッセージは、遅延期間の間は受信側に表示されません。  
キュー全体に対する遅延時間は遅延キュー内で指定しますが、個々のメッセージの遅延時間はメッセージタイマー（MessageTimer）で指定します。  
いずれもデフォルト遅延は0秒で、最大は15分です。

## 可視性タイムアウ
メッセージが取得されてから一定期間、同じメッセージを他のシステムから取得できないようにブロックする
デフォルト設定では30秒となっており、あるシステムがメッセージを受け取った後の30秒間、他のシステムからは当該メッセージが見えなくなります。

## デッドレターキュー
エラーが原因でキューからメッセージが受信できないと、メッセージが残り続けてしまうので
何回かリトライを実施した後で、自動的に別のキューにメッセージを移動する機能をデッドレターキューという

